<!--CODE HEAVILY ADAPTED/SOURCED FROM https://jsfiddle.net/KeithMcMillenInstruments/nLwLthj0/?utm_source=website&utm_medium=embed&utm_campaign=nLwLthj0 -->


<!doctype html>
<html>
<head>

<title>Bandpass Filtering</title>

</head>

<body>

<div id="wrapper">
    <div id="content">

      
<div class="post">
  <h2>Fun with Bandpass Filtering</h2>
  <p>
    This lets you to apply a bandpass filter to a given audio sample. Play around with the center frequency and Q values!
</p>

<p><input type="button" onclick="sample.toggle();" value="Play/Pause"></p>

<p><input type="checkbox" id="daBox" checked="false" onchange="sample.toggleFilter(this);"
<label for="daBox"><span></span>Enable filter</label></p>

<p><input type="range" min="0" max="1" step="0.01" value="1" oninput="sample.changeFrequency(this);">Frequency</p>

<p><input type="range" min="0" max="1" step="0.01" value="0" oninput="sample.changeQuality(this);">Quality</p>

        </p>
        </div>
    </div>
</div>

<script>
var sample = new FilterSample();
</script>

  </p>
</div>


    </div>

  </div>


<script>

var QUAL_MUL = 30;

function FilterSample() {
  this.isPlaying = false;
  loadSounds(this, {buffer: 'Crimewave.mp3'});
};

FilterSample.prototype.play = function() {
  // Create the source.
  var source = context.createBufferSource();
  source.buffer = this.buffer;
  // Create the filter.
  var filter = context.createBiquadFilter();
  filter.type = filter.bandpass;
  filter.frequency.value = 5000;
  // Connect source to filter, filter to destination.
  source.connect(filter);
  filter.connect(context.destination);
  // Play!
  source[source.start ? 'start' : 'noteOn'](0);
  source.loop = true;
  // Save source and filterNode for later access.
  this.source = source;
  this.filter = filter;
};

FilterSample.prototype.stop = function() {
  this.source.stop(0);
};

FilterSample.prototype.toggle = function() {
  this.isPlaying ? this.stop() : this.play();
  this.isPlaying = !this.isPlaying;
};

FilterSample.prototype.changeFrequency = function(element) {
  // Clamp the frequency between the minimum value (40 Hz) and half of the
  // sampling rate.
  var minValue = 40;
  var maxValue = context.sampleRate / 2;
  // Logarithm (base 2) to compute how many octaves fall in the range.
  var numberOfOctaves = Math.log(maxValue / minValue) / Math.LN2;
  // Compute a multiplier from 0 to 1 based on an exponential scale.
  var multiplier = Math.pow(2, numberOfOctaves * (element.value - 1.0));
  // Get back to the frequency value between min and max.
  this.filter.frequency.value = maxValue * multiplier;
};

FilterSample.prototype.changeQuality = function(element) {
  this.filter.Q.value = element.value * QUAL_MUL;
};

FilterSample.prototype.toggleFilter = function(element) {
  this.source.disconnect(0);
  this.filter.disconnect(0);
  // Check if we want to enable the filter.
  if (element.checked) {
    // Connect through the filter.
    this.source.connect(this.filter);
    this.filter.connect(context.destination);
  } else {
    // Otherwise, connect directly.
    this.source.connect(context.destination);
  }
};

</script>
</body>
</html>
