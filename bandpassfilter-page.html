<!--CODE HEAVILY ADAPTED/SOURCED FROM https://jsfiddle.net/KeithMcMillenInstruments/nLwLthj0/?utm_source=website&utm_medium=embed&utm_campaign=nLwLthj0 -->


<!DOCTYPE html>

<html>
<title>BandPass Filtering</title>
<body>
    <h1>Fun With Bandpass Filtering</h1>
    
    <br>
    
    <h3>Experiment with applying a bandpass filter to the audio!  You can adjust the Q and the center frequency.</h3>

    <br>
    <br>
<div class='controls'>
    <button class="play" disabled>loading...</button>
    <button class="stop" disabled>stop</button>
</div>

<div class='filter-controls'>
    <label for='filterFreq'>Filter Frequency <span class='freq'>2500Hz</span>

        <input class='filter-slider' name='filterFreq' type='range' min='0' max='20000' step='10' value='2500' disabled />
    </label>
    
    <label>Quality (Q) Value <span class='filter-q-value'>1</span> 
        <input class="filter-q-slider" type="range" min=".0001" max="10" step=".0005" value="1" disabled/>
    </label>
    
    
</div>

<h3><a href="index.html">Back to Home</a></h3>

<script>
var audioContext = new(window.AudioContext || window.webkitAudioContext)();
    filter = audioContext.createBiquadFilter();
    filter.type = 'bandpass';
    Crimewave = 'Crimewave.mp3';
    sampleBuffers, sound, playButton = document.querySelector('.play');
    stopButton = document.querySelector('.stop');
    loop = false;

    filterFreq = document.querySelector('.freq');
    filterFreqSlider = document.querySelector('.filter-slider');

    filterQ = document.querySelector('.filter-q-value');
    filterQSlider = document.querySelector('.filter-q-slider');

// load our sound
init();

function init() {
    loadSound(Crimewave);
}

playButton.onclick = function () {
    playSound();
};

stopButton.onclick = function () {
    stopSound();
};

filterFreqSlider.oninput = function () {
    changeFilterFreq(filterFreqSlider.value);
};

filterQSlider.oninput = function () {
    changeFilterQ(filterQSlider.value);
};

// function to load sounds via AJAX
function loadSound(url) {
    var request = new XMLHttpRequest();
    request.open('GET', url, true);
    request.responseType = 'arraybuffer';

    request.onload = function () {
        audioContext.decodeAudioData(request.response, function (buffer) {
            sampleBuffer = buffer;
            playButton.disabled = false;
            playButton.innerHTML = 'play';
        });
    };

    request.send();
}
// setup sound, loop, and connect to destination
function setupSound() {
    sound = audioContext.createBufferSource();
    sound.buffer = sampleBuffer;
    sound.loop = loop;
    sound.connect(filter);
    filter.connect(audioContext.destination);
}

// play sound and enable / disable buttons
function playSound() {
    setupSound();
    UI('play');
    sound.start(0);
    sound.onended = function () {
        UI('stop');
    }
}

// stop sound and enable / disable buttons
function stopSound() {
    UI('stop');
    sound.stop(0);
}

// change filter frequency and update display 
function changeFilterFreq(freq) {
    filter.frequency.value = freq;
    filterFreq.innerHTML = freq + 'Hz';
}

// change filter Q and update display
function changeFilterQ(Q) {
    filter.Q.value = Q;
    filterQ.innerHTML = Q;
}

function UI(state){
    switch(state){
        case 'play':
            playButton.disabled = true;
            stopButton.disabled = false;
            filterFreqSlider.disabled = false;
            filterQSlider.disabled = false;
            break;
        case 'stop':
            playButton.disabled = false;
            stopButton.disabled = true;
            filterFreqSlider.disabled = true;
            filterQSlider.disabled = true;
            break;
    }
}
</script>
</body>
</html>
