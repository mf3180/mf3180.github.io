<!DOCTYPE html>

<html>
<title>Experimenting with Delay Effects</title>
<body>
	<h1>Experimenting with Delay Effects</h1>

	<br>

	<h3>Experiment with applying a delay effect to the embedded audio.  Use the sliders below to play around with the time of the delay, the amount of feedback, and the phase inversion.</h3>

	<br>
	<br>

	<div class='controls'>
		<button class="play" disabled>loading...</button>
		<button class="stop" disabled>stop</button>
	</div>

	<br>

<div class='delay-controls'>
    <label for='delayTime'>Delay Time: <span class='time'>1.0 s</span>

        <input class='delayTime-slider' name='delayTime' type='range' min='0' max='5' step='0.1' value='0.5' disabled/>
    </label>

    <!--<p>Filter Type: </p>
    <select name="filterType" class="filtertype">
        <option value="lowpass">Lowpass</option>
    </select> -->
</div>

<br>
<br>

<h3><a href="index.html">Back to Home</a></h3>

</body>
<script>

var audioContext = new(window.AudioContext || window.webkitAudioContext)(),
myDelay = audioContext.createDelay(),
ROBYN = "Dancing On My Own.mp3",
sampleBuffers, sound, playButton = document.querySelector('.play'),
stopButton = document.querySelector('.stop'),
loop = false,
loopButton = document.querySelector('.loop');

delayTime = document.querySelector('.time');
delayTimeSlider = document.querySelector('.delayTime-slider');


//this function loads the sound
init();

function init() {
	loadSound(ROBYN);
};

playButton.onclick = function () {
	playSound();
};

stopButton.onclick = function() {
	stopSound();
};


//this function loads the sound
function loadSound(url) {
	var getRobynBuffer = new XMLHttpRequest();
getRobynBuffer.open("GET", url, true);
getRobynBuffer.responseType = "arraybuffer";

getRobynBuffer.onload = function() {
	audioContext.decodeAudioData(getRobynBuffer.response, function(buffer){
		RobynBuffer = buffer;
		playButton.disabled = false;
		playButton.innerHTML = 'play';
	});
};

getRobynBuffer.send();

}

//this function sets up the sound
function setupRobyn() {
	sound = audioContext.createBufferSource();
	sound.buffer = RobynBuffer;
	sound.loop = loop;
	sound.connect(delay);
	delay.connect(audioContext.destination);
}

//this function plays the audio & enables/disables buttons
function playRobyn() {
	setupRobyn();
	UI('play');
	sound.start(0);
	sound.onended = function () {
		UI('stop');
	}
}

//this function stops the sound and enables/disables buttons

function stopSound() {
	UI('stop');
	sound.stop(0);
}

function changeDelayTime(time) {
	delay.time.value = time;
	delayTime.innerHTML = time + 's';
}

function UI(state){
	switch(state){
		case 'play':
			playButton.disabled = true;
			stopButton.disabled = false;
			delayTimeSlider.disabled = false;
			break;
		case 'stop':
			playButton.disabled = false;
			stopButton.disabled = true;
			delayTimeSlider.disabled = true;
		break;
	}
}

</script>
</html>